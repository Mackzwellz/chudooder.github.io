<!DOCTYPE html>
<html>
<head>
  <title> Dota 2 Chat Wheel Scripter </title>
  <link rel="stylesheet" type="text/css" href="css/d2style.css">
</head>
<body>
  <script src="js/jquery-2.0.3.js"></script>
  <div id="dialog-overlay"></div>
  <div id="title-container">
    <h1> Dota 2 Chat Wheel Scripting </h1>
    <p> Make your own chat wheels and bind them to different keys! </p>
  </div>
  <div id="wheels">

  </div>

  <div id="dialog">
    <h1> Phrases </h1>
    <div id='dialog-scroll-list'>
      
    </div>
  </div>
  <div id="wrapper">
    <div class="add-button">
      <div class="add-button-text">Add Chat Wheel</div>
    </div>
    <div class="done-button">
      <div class="done-button-text">Done!</div>
    </div>
  </div>

  <div id="script-box">
    <p> Paste this into your autoexec.cfg file: </p>
    <hr>
    <div id="script-text">
      Nothing here yet!
    </div>
    <hr>
    <p> Remember to unbind the original chat wheel key from inside Dota 2, or else things will mess up. </p>
  </div>

</body>

<script src="js/chat_msg_list.js"></script>

<script>
  //Set up the phrase selection dialog.
  var dialog = $('#dialog-scroll-list');
  for(var i=0; i<phraseList.length; i++) {
    if(phraseList[i].name==="Careful!")
      dialog.append("<hr><h2> POSITIONING </h2>");
    if(phraseList[i].name==="Help!") 
      dialog.append("<hr><h2> STATUS </h2>");
    if(phraseList[i].name==="Missing!") 
      dialog.append("<hr><h2> ENEMY </h2>");
    if(phraseList[i].name==="Split push") 
      dialog.append("<hr><h2> LANE </h2>");
    if(phraseList[i].name==="We need wards.") 
      dialog.append("<hr><h2> ITEMS </h2>");
    if(phraseList[i].name==="Stack and pull please")
      dialog.append("<hr><h2> NEUTRALS </h2>");
    if(phraseList[i].name==="Okay.")
      dialog.append("<hr><h2> MISC </h2>");
    if(phraseList[i].name==="Well played!")
      dialog.append("<hr><h2> FLAVOR </h2>");
    $("<div class='dialog-text'>"+phraseList[i].name+"</div>")
      .data('phraseindex', i)
      .appendTo(dialog);
  }

  $(document).ready(function() {

    var targetBox = null;
    var targetIndex = -1;
    var targetWheel = -1;
    // holds data for the selected phrases
    var selections = [];
    var keySelections = [];
    var light = false;

    var addListeners = function() {
      $('.box').click(function(e) {
        targetBox = $(this);
        targetIndex = targetBox.data('boxnum');
        targetWheel = targetBox.data('wheelnum');
        $('#dialog').fadeIn(200);
        $('#dialog-overlay').fadeIn(200);
      });

      $('.box').mouseenter(function(e) {
        // update target variables
        targetBox = $(this);
        targetIndex = targetBox.data('boxnum');
        targetWheel = targetBox.data('wheelnum');

        // rotate the wheel
        var deg = targetIndex*45;
        var wheel = $(this).parent().parent().children(".left").children(".wheel");
        wheel.css("transform","rotate("+deg+"deg)");
        wheel.css("-webkit-transform","rotate("+deg+"deg)");
      });

      $('.box').mouseleave(function(e) {
        // reset wheel to neutral
        var wheel = $(this).parent().parent().children(".left").children(".wheel");
        wheel.css("transform","rotate(0deg)");
        wheel.css("-webkit-transform","rotate(0deg)");
      });

      $(".key").keypress(function(e){
        return false;
      });

      $(".key").keydown(function(e){
        var charCode = (e.which) ? e.which : event.keyCode;
        var wheel = $(this).data('wheelnum');
        keySelections[wheel] = charCode;
        e.target.value = keyMap[charCode].name;
      });
    }

    $(".dialog-text").click(function(e) {
      var num = $(this).data('phraseindex');
      console.log(num);
      selections[targetWheel][targetIndex] = num;
      targetBox.children('.box-text').text($(this).text());
      $('#dialog').fadeOut(200);
      $('#dialog-overlay').fadeOut(200);
      targetBox = null;
      targetIndex = -1;
    });

    $(".done-button").click(function(e) {
      makeConfig();
    });

    $(".add-button").click(function(e) {
      makeContainer();
    });

    $("#dialog-overlay").click(function(e) {
      targetBox = null;
      targetIndex = -1;
      $('#dialog').fadeOut(200);
      $('#dialog-overlay').fadeOut(200);
    });

    var makeConfig = function() {
      var script = "";
      for(var k=0; k<selections.length; k++) {
        var key = keyMap[keySelections[k]].scriptname;
        script += "bind "+key+" \"+chatwheel; chat"+k+"\"<br/>alias chat"+k+" \""
        for(var i=0; i<8; i++) {
          script += "chat_wheel_phrase_"+i+" "+phraseList[selections[k][i]].gameindex+";";
        }
        script += "\"<br/>";
      }
      $("#script-box").show();
      $("#script-text").html(script);
    }

    var makeContainer = function() {
      // create the container
      var num = selections.length;
      $('#wheels').append("<div class='container'><div class='left'><span class='helper'></span><img class='wheel' src='img/wheel.png'></div><div class='right'></div><div class='moreright'>Select a key:<input class='key'></div><div class='rightdown'><div class='delete-button'><div class='delete-button-text'>Delete</div></div></div><div style='clear:both'></div></div>");
      for(var i=0; i<8; i++) {
        var phrase = phraseList[i].name;
        $("<div class=\"box\">\n<div class='box-text'>"+phrase+"</div>\n</div>")
          .data( {"wheelnum": num, "boxnum": i} )
          .appendTo($('.right:last'));
      }
      if(light) {
        $('.container:last').css("background-color", "#222");
      }

      $('.key:last').data('wheelnum', num);

      light = !light;
      addListeners();
      selections[selections.length] = [0,1,2,3,4,5,6,7];
      keySelections[keySelections.length] = 0;
    }

    makeContainer();


  });
</script>

<div id="preload">
   <img src="img/wheel.png" width="1" height="1" alt="Image 02" />
</div>


</html>